<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación de riesgos</title>
    <script src="https://cdn.jsdelivr.net/npm/gaugeJS/dist/gauge.min.js"></script>
    <link href="../estilos/estiloEncuestas.css" rel="stylesheet">
    <!-- <link href="css/st-gobCorpo.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Abel&family=Barlow+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Courgette&family=Gupter:wght@400;500;700&family=PT+Sans+Narrow:wght@400;700&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Serif:ital,opsz,wght@0,8..144,100..900;1,8..144,100..900&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>


    <style>
        .google-loader {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            height: 100px;
            margin-top: 20px;
        }

        .dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            animation: bounce 1.2s infinite ease-in-out;
        }

        .dot:nth-child(1) {
            background-color: #4285F4;
            /* Azul Google */
            animation-delay: 0s;
        }

        .dot:nth-child(2) {
            background-color: #EA4335;
            /* Rojo Google */
            animation-delay: 0.15s;
        }

        .dot:nth-child(3) {
            background-color: #FBBC05;
            /* Amarillo Google */
            animation-delay: 0.3s;
        }

        .dot:nth-child(4) {
            background-color: #34A853;
            /* Verde Google */
            animation-delay: 0.45s;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-12px);
            }
        }

        .loader-text {
            margin-top: 10px;
            font-size: 18px;
            text-align: center;
            font-family: "Abel";
        }
    </style>

</head>

<body>
    <div class="survey-container">
        <section class="main">
            <section class="gobCorpo">
                <div class="header-container">
                    <div class="header-center">
                        <div id="nombreEmpresa" class="company-name"></div>
                        <div id="nombreUsuario" class="user-name"></div>
                    </div>
                    <div class="nav-iconsxx">
                        <h4>Autoevaluación de la calidad del manejo de la empresa</h4>
                    </div>
                    <div class="nav-iconsxx">
                    </div>
                </div>
                <hr>

                <form id="formularioFinal" style="display: block;">
                    <div class="center-container">
                        <h4 class="tituloSeccion"><a href="Menu-A.html">Generación del informe con recomendaciones</a>
                        </h4>
                    </div>

                    <p>Este proceso crea el documento
                        <span style="text-align: center; font-size: 22px; font-weight: bold;"> Informe HexaRCi.pdf
                        </span>
                        que se descargará automáticamente. Aguarde, por favor...
                    </p>

                    <div id="loader" class="loader-container" style="display: block;">
                        <div class="google-loader">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        <div class="loader-text">Generando documento...</div>
                    </div>
                </form>

                <form id="formularioSaludo" style="display: none;">
                    <div class="center-container">
                        <h4 class="tituloSeccion"><a href="Menu-A.html">Generación del informe con recomendaciones</a>
                        </h4>
                    </div>
                    <br><br>
                    <div style="text-align: center;">
                        <span style="font-size: 22px; font-weight: bold;">El documento ha sido creado</span>
                    </div>

                </form>

            </section>
        </section>
    </div>
</body>


<!-- https://claude.ai/chat/da1b05d0-f15d-487d-bd62-f4f05b81c356
https://claude.ai/login?returnTo=%2F%3F
El tamaño de una hoja A4 es de 210 x 297 milímetros, es decir, 21 centímetros de ancho por 29,7 centímetros de largo.  -->

<script>

    const apellidouser = localStorage.getItem("apellido");
    const nombreUser = localStorage.getItem("nombre");
    const apenom = nombreUser + ' ' + apellidouser;
    const empresa = localStorage.getItem("empresa");
    const CUIT = localStorage.getItem("CUIT");
    document.getElementById("nombreEmpresa").textContent = empresa;
    document.getElementById("nombreUsuario").textContent = apenom;
    const idioma = localStorage.getItem("idioma");

    let max = 90;
    let numPagina = 0;

    const textoTipificacion = localStorage.getItem("textoTipificacion");
    const tipificacion = localStorage.getItem("tipificacion");

    // document.addEventListener("DOMContentLoaded", function () {
    //     document.getElementById("boton-generar-pdf").addEventListener("click", generarPDF);
    // });

    document.addEventListener("DOMContentLoaded", function () {
        // Mostramos el loader (ya está visible por defecto, pero por si acaso)
        document.getElementById("loader").style.display = "block";

        // Esperamos 200 ms antes de empezar para que el loader se pinte
        setTimeout(() => {
            iniciarGeneracion();
        }, 200);
    });

    async function iniciarGeneracion() {
        try {
            // Aguardamos un poco para que el texto "Generando informe..." aparezca
            await new Promise(resolve => setTimeout(resolve, 100));

            // Ahora llamamos a la función que empieza el trabajo pesado
            await generarPDF();

            // Ocultamos el loader si querés
            document.getElementById("loader").style.display = "none";
        } catch (error) {
            console.error("Error al generar el PDF:", error);
        }
    }

    async function generarPDF() {

        textoCheck = await leeTextoCheck();
        textoRespuestas = await leeTextoRespuestas();

        const opciones = {
            margin: 0,
            filename: 'documento.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        // Crear un elemento temporal para construir el contenido HTML
        const contenido = document.createElement('div');

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Caratula
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::        

        const primeraPagina = document.createElement('div');
        primeraPagina.style.width = 'calc(100% - 20mm)'; // Ancho ajustado para márgenes
        primeraPagina.style.height = '277mm'; // Altura A4 menos márgenes
        primeraPagina.style.margin = '10mm';
        primeraPagina.style.border = '1px solid #000';
        // primeraPagina.style.backgroundImage = 'url("../img/imagenPDF.webp")';
        // primeraPagina.style.backgroundImage = 'url("../img/imagenPDF2.png")';
        // primeraPagina.style.backgroundImage = 'url("../img/imagenPDF3.png")';
        // primeraPagina.style.backgroundImage = 'url("../img/imagenEdificios.webp")';
        primeraPagina.style.backgroundImage = 'url("../img/caratula_hexarci.jpeg")';
        primeraPagina.style.backgroundSize = 'contain';
        primeraPagina.style.backgroundPosition = 'center';
        primeraPagina.style.pageBreakAfter = 'always';

        // const tituloCaratula = document.createElement('h1');
        // tituloCaratula.textContent = 'Índice General';
        // tituloCaratula.style.textAlign = 'center';
        // tituloCaratula.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        // tituloCaratula.style.fontSize = '26pt';
        // tituloCaratula.style.color = 'white';
        // tituloCaratula.style.textShadow = '2px 2px 4px rgba(0, 0, 0, 0.5), -2px -2px 4px rgba(255, 255, 255, 0.3)';
        // tituloCaratula.style.marginTop = '40mm';
        // tituloCaratula.innerHTML = ""
        // primeraPagina.appendChild(tituloCaratula);

        const segundaLeyenda = document.createElement('h2');
        segundaLeyenda.innerHTML = empresa;
        segundaLeyenda.style.textAlign = 'center';
        segundaLeyenda.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        segundaLeyenda.style.fontSize = '35pt';
        segundaLeyenda.style.color = 'black';
        segundaLeyenda.style.textShadow = '2px 2px 4px rgba(0, 0, 0, 0.5), -2px -2px 4px rgba(255, 255, 255, 0.3)';
        segundaLeyenda.style.marginTop = '550px'; // Ajusta según necesites
        primeraPagina.appendChild(segundaLeyenda);

        contenido.appendChild(primeraPagina);



        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir la segunda página (índice)
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        const paginaIndice = crearPaginaConMarco();
        // Establecer la imagen de fondo
        // paginaIndice.style.backgroundImage = 'url("../img/imagenEdificios.webp")';
        // paginaIndice.style.backgroundSize = 'cover';
        // paginaIndice.style.position = 'relative';
        // paginaIndice.style.width = 'calc(100% - 20mm)'; // Ancho ajustado para márgenes
        // paginaIndice.style.height = '277mm'; // Altura A4 menos márgenes
        // paginaIndice.style.margin = '10mm';

        // Crear un div overlay
        // let overlay = document.createElement("div");
        // overlay.style.position = "absolute";
        // overlay.style.top = "0";
        // overlay.style.left = "0";
        // overlay.style.width = 'calc(100% - 20mm)'; // Ancho ajustado para márgenes
        // overlay.style.height = '277mm'; // Altura A4 menos márgenes
        // overlay.style.backgroundColor = "rgba(255, 255, 255, 0.9)"; // Ajusta la transparencia
        // overlay.style.pointerEvents = "none"; // Evita interferencias con eventos
        // Agregar el overlay al elemento
        // paginaIndice.appendChild(overlay);

        const tituloIndice = document.createElement('h1');
        tituloIndice.textContent = 'Índice General';
        tituloIndice.style.textAlign = 'center';
        tituloIndice.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        paginaIndice.appendChild(tituloIndice);

        // const indice = ["El Modelo HexaRCi en la optimización empresarial y la Gestión de Riesgos",
        //     "Estructura del Modelo HexaRCi",
        //     "Aplicación del Modelo HexaRCi y conclusiones",
        //     "Representación gráfica",
        //     "Recomendaciones.  Oportunidades de mejora"];
        // const listaIndice = document.createElement('ol');
        // listaIndice.style.marginTop = '5mm';
        // listaIndice.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';

        // indice.forEach(item => {
        //     const elementoLista = document.createElement('li');
        //     elementoLista.textContent = item;
        //     elementoLista.style.marginBottom = '5mm';
        //     listaIndice.appendChild(elementoLista);
        // });
        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '12pt';
        parrafo.style.lineHeight = '1.5';
        parrafo.style.fontStyle = 'normal'; // Agregar estilo itálico
        parrafo.style.marginTop = '5mm';
        parrafo.innerHTML = "1. El modelo HexaRCi en la optimización empresarial y la Gestión de Riesgos<br>2. Estructura del Modelo HexaRCi.<br>2.1. Alcance de la Autoevaluación<br>2.2. Factores de Riesgo evaluados<br>2.3. Factores temporales.<br>3. Evaluación del Cumplimiento<br>3.1. Gobierno Corporativo<br>3.2. Apetito de Riesgo<br>3.3. Riesgos de Mercado<br>3.4. Riesgos de Procesos.<br>3.5. Sistema Financiero<br>3.6. Generación de Resultados<br>4.  Aplicación del modelo HexaRCi y Conclusiones.<br>5. Representación Gráfica<br>6. Recomendaciones.  Oportunidades de mejora."
        paginaIndice.appendChild(parrafo);


        // paginaIndice.appendChild(listaIndice);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '11pt';
        parrafo.style.lineHeight = '1.5';
        parrafo.style.fontStyle = 'italic'; // Agregar estilo itálico
        parrafo.style.marginTop = '100mm';
        parrafo.innerHTML = "De acuerdo con los términos de la Propuesta de servicios profesionales de BDT Advisory LLC para NOMBRE DEL CLIENTE del Sistema HexaRCi, el presente informe tiene el ámbito de uso reservado previsto en la misma."
        paginaIndice.appendChild(parrafo);

        contenido.appendChild(paginaIndice);




        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir la tercera página (contenido) con un borde
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        const terceraPagina = crearPaginaConMarco();

        const tituloTercera = document.createElement('p');
        tituloTercera.innerHTML = "1. El Modelo HexaRCi en la optimización empresarial y la Gestión de Riesgos";
        tituloTercera.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        tituloTercera.style.fontSize = '16pt';
        tituloTercera.style.fontWeight = 'bold';
        tituloTercera.style.textAlign = 'left';
        tituloTercera.style.marginTop = '5mm';
        terceraPagina.appendChild(tituloTercera);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.5';
        parrafo.innerHTML = "En el dinámico escenario empresarial actual, las organizaciones enfrentan el desafío constante de incrementar su rentabilidad y mantener una posición competitiva sólida. Este objetivo fundamental requiere una comprensión profunda y un manejo estratégico de los diversos factores de riesgo que pueden impactar el desempeño y la sostenibilidad del negocio.<br><br>Cada estructura empresarial aspira a un modelo de organización y funcionamiento ideal, un esquema que maximice la eficiencia operativa y minimice la exposición a riesgos potenciales. Sin embargo, alcanzar este estado óptimo no es un proceso simple, sino un ejercicio complejo de análisis, evaluación y adaptación continua.<br><br>En este contexto, la herramienta HexaRCi se presenta como un instrumento innovador que permite a las organizaciones navegar de manera sistemática y racional a través de su modelo de negocio. HexaRCi ofrece a los usuarios una perspectiva integral para recorrer los elementos críticos de la organización, facilitando la elaboración de estrategias que aproximan a la empresa hacia su esquema de funcionamiento ideal.<br><br>Como resultado de su aplicación, la Alta Dirección obtiene un recurso fundamental: un informe detallado pero abarcativo que proporciona una visión panorámica de toda la organización. Este documento no solo presenta un diagnóstico general, sino que identifica con precisión los aspectos más débiles que obstaculizan la consecución de una organización de excelencia. Un valor agregado distintivo de este informe radica en su origen: es elaborado mediante una autoevaluación realizada por el personal interno, lo que garantiza una perspectiva auténtica, inmediata y profundamente conocedora de los procesos y dinámicas organizacionales<br><br>Mediante un enfoque metódico, esta herramienta proporciona un marco de referencia para identificar, analizar y gestionar los riesgos empresariales, transformando lo que tradicionalmente se percibe como una amenaza en una oportunidad de mejora y crecimiento estratégico.";
        terceraPagina.appendChild(parrafo);

        contenido.appendChild(terceraPagina);

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir la sexta pagina con un borde
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        let paginaHexa = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "2. Estructura del Modelo HexaRCi";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        paginaHexa.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "El proceso de autoevaluación del modelo HexaRCi fue completado por el personal de la empresa que asumió la responsabilidad de evaluar cada consigna. La información presentada en este informe refleja directamente la perspectiva y el análisis realizados, cuya validez y precisión dependen directamente del grado de objetividad y certeza con el que se respondió a cada consulta. En este sentido, las conclusiones aquí expuestas están directamente condicionadas por la rigurosidad y transparencia con que se abordó cada aspecto de la evaluación, siendo fundamental reconocer que la calidad del diagnóstico es un reflejo directo de la objetividad en el proceso de autoevaluación.<br><br><strong>Alcance de la Autoevaluación</strong><br><br>El proceso de autoevaluación comprendió el análisis de cuatro factores de riesgo fundamentales y dos factores temporales, proporcionando una visión integral de la situación organizacional:<br><br>Factores de Riesgo Evaluados<br><br>1. <strong>Riesgos del Gobierno Corporativo.</strong> Representa el conjunto de procesos, principios y valores que rigen la forma en que una organización es estrategizada, administrada, controlada y transparentada. Las fallas en el sistema de Gobierno pueden conducir a la disfuncionalidad de los procesos. El sistema de gobierno corporativo impacta en el Apetito de Riesgo y su calidad operativa-funcional determina el manejo de los riesgos de mercado y de los procesos.<br>Se han propuesto <strong> 84 declaraciones </strong> que han sido evaluadas identificando su grado de cumplimiento o aplicación en la empresa.";

        paginaHexa.appendChild(parrafo);

        parrafo = document.createElement('p');
        // parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "2. <strong>Apetito de Riesgo.</strong> Representa la cantidad de riesgo que la empresa está dispuesta a 'tomar'. Un Apetito de Riesgo alto puede llevar al crecimiento y a utilidades, pero puede llevar también a enfrentar pérdidas importantes. Un Apetito de Riesgo bajo puede llevar a perder posiciones competitivas o a la inmovilidad. El objetivo es tener un Apetito de Riesgo adecuado en relación con las necesidades competitivas y la cultura de la empresa.<br>Se han propuesto <strong> 71 declaraciones </strong> que han sido evaluadas identificando su grado de cumplimiento o aplicación en la empresa.";

        paginaHexa.appendChild(parrafo);

        contenido.appendChild(paginaHexa);

        paginaHexa = crearPaginaConMarco();

        parrafo = document.createElement('p');
        // parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "3. <strong>Riesgos de Mercado.</strong>Se refieren a las amenazas o peligros debido a factores externos y que pueden tener un impacto negativo en los objetivos y resultados deseados. Los riesgos del mercado son parte del sistema estratégico/táctico de la compañía y, conjuntamente con los riesgos de los procesos y el apetito de riesgo constituyen los riesgos que tiene que manejar el Sistema de Gobierno Corporativo.<br>Se han propuesto <strong> 43 declaraciones </strong> que han sido evaluadas identificando su grado de cumplimiento o aplicación en la empresa.";

        paginaHexa.appendChild(parrafo);

        parrafo = document.createElement('p');
        // parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "4. <strong>Riesgos de los Procesos.</strong>Comprenden las secuencias de actividades interrelacionadas que se llevan a cabo para alcanzar los objetivos de la empresa. Incluyen conceptualmente: Procesos de Gestión, Procesos Operativos y Procesos de Soporte. La identificación, modelado y mejora continua de estos procesos son elementos clave para aumentar la eficiencia, la calidad y la competitividad de la empresa. El objetivo es tener procesos sólidos que minimicen la posibilidad de incurrir en pérdidas por mal manejo de los mismos.<br>Se han propuesto <strong> 276 declaraciones </strong> que han sido evaluadas identificando su grado de cumplimiento o aplicación en la empresa.";

        paginaHexa.appendChild(parrafo);

        parrafo = document.createElement('p');
        // parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        // parrafo.style.fontSize = '13pt';
        // parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Factores temporales.";

        paginaHexa.appendChild(parrafo);

        parrafo = document.createElement('p');
        // parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        // parrafo.style.fontSize = '13pt';
        // parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Situación Financiera.<br><br>Algún texto habría que poner para homogeneizar con lo anterior";

        paginaHexa.appendChild(parrafo);

        parrafo = document.createElement('p');
        // parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        // parrafo.style.fontSize = '13pt';
        // parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Generación de Resultados.<br><br>Igual que en situación financiera";

        paginaHexa.appendChild(parrafo);

        contenido.appendChild(paginaHexa);
        console.log("pagina 2. Estructura")

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir evaluacion de cumplimiento
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        otraPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "3. Evaluación del Cumplimiento";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        otraPagina.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Con base en las respuestas proporcionadas, se determinó el grado de cumplimiento o aproximación a la situación ideal para cada factor de riesgo, expresado como un porcentaje.<br><br>Cada factor o elemento de riesgo recibió un 'porcentaje de cumplimiento' que refleja su estado actual en comparación con los estándares óptimos establecidos en el modelo HexaRCi. Los resultados obtenidos se presentan a continuación:<br><br>Cuadro General:<br><br>";
        otraPagina.appendChild(parrafo);

        // crea la tabla de totales por capitulo
        capitulos = await leeCapitulos();
        totalCapitulos = await obtenerTotalCapitulos(CUIT);

        // Crear la tabla si no existe
        let tabla = document.createElement("table");
        tabla.style.width = "90%";
        tabla.style.borderCollapse = "collapse";

        // Agregar encabezado (opcional)
        let encabezado = document.createElement("tr");
        encabezado.innerHTML = `
                <th style="text-align: center; padding: 5px;">#</th>
                <th style="text-align: left; padding: 25px;">Factor</th>
                <th style="text-align: center; padding: 5px;">%</th>
            `;
        tabla.appendChild(encabezado);

        // Llenar la tabla con datos
        for (const capitulo of totalCapitulos) {
            const capituloNombre = capitulos.find(c => c.letra === capitulo.capitulo)?.nombre || 'Nombre no encontrado';

            const fila = document.createElement("tr");
            fila.classList.add("situacion2");

            fila.innerHTML = `
                    <td style="padding: 5px;">${capitulo.capitulo}</td>
                    <td style="text-align: left; padding: 15px; font-size: 18px">${capituloNombre}</td>
                    <td style="text-align: center; padding: 5px;">${capitulo.porcentaje}</td>
                `;

            tabla.appendChild(fila);
        }

        // Finalmente, agregar la tabla a la página
        otraPagina.appendChild(tabla);

        contenido.appendChild(otraPagina);
        console.log("pagina 3 Evaluacion")

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir evaluacion de cumplimiento - Gobierno Corporativo
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        otraPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "3.1. Evaluación del Cumplimiento - Gobierno Corporativo";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        otraPagina.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Se han formulado <strong>84 declaraciones</strong>, distribuidas en 15 secciones temáticas, con el propósito de evaluar su nivel de implementación, cumplimiento o adhesión dentro de la organización.  El resultado de esta evaluación se presenta en el porcentaje alcanzado.";
        otraPagina.appendChild(parrafo);

        // Crear la tabla

        // crea la tabla de totales por capitulo
        capitulo = "A";
        secciones = await leerSecciones(idioma, capitulo);
        respuestas = await leerRespuestas(CUIT, capitulo);

        // Crear la tabla si no existe
        tabla = document.createElement("table");
        tabla.style.width = "90%";
        tabla.style.borderCollapse = "collapse";

        // Agregar encabezado (opcional)
        encabezado = document.createElement("tr");
        encabezado.innerHTML = `
                <th style="text-align: center; padding: 5px;">#</th>
                <th style="text-align: left; padding: 15px;">Sección</th>
                <th style="text-align: center; padding: 5px;">%</th>
            `;
        tabla.appendChild(encabezado);

        // Llenar la tabla con datos
        for (const secc of secciones.records) {
            const porceCumpli = respuestas.records.find(c => c.seccion === secc.seccion)?.porcentaje || 999;

            const fila = document.createElement("tr");
            fila.classList.add("situacion2");

            fila.innerHTML = `
                    <td style="padding: 10px;">${secc.seccionromano}</td>
                    <td style="text-align: left; padding: 10px; font-size: 18px">${secc.descripcion}</td>
                    <td style="text-align: center; padding: 10px;">${porceCumpli}</td>
                `;

            tabla.appendChild(fila);
        }

        // Finalmente, agregar la tabla a la página
        otraPagina.appendChild(tabla);

        contenido.appendChild(otraPagina);

        console.log("pagina 3.1. Gob Corpo")

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir evaluacion de cumplimiento - Apetito de riesgo
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        otraPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "3.2. Evaluación del Cumplimiento - Apetito de Riesgo";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        otraPagina.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Algun texto descriptivo....:<br><br>";
        otraPagina.appendChild(parrafo);

        // crea la tabla de totales por capitulo
        capitulo = "B";
        secciones = await leerSecciones(idioma, capitulo);
        respuestas = await leerRespuestas(CUIT, capitulo);

        // Crear la tabla si no existe
        tabla = document.createElement("table");
        tabla.style.width = "90%";
        tabla.style.borderCollapse = "collapse";

        // Agregar encabezado (opcional)
        encabezado = document.createElement("tr");
        encabezado.innerHTML = `
                <th style="text-align: center; padding: 5px;">#</th>
                <th style="text-align: left; padding: 15px;">Sección</th>
                <th style="text-align: center; padding: 5px;">%</th>
            `;
        tabla.appendChild(encabezado);

        // Llenar la tabla con datos
        for (const secc of secciones.records) {
            const porceCumpli = respuestas.records.find(c => c.seccion === secc.seccion)?.porcentaje || 999;

            const fila = document.createElement("tr");
            fila.classList.add("situacion2");

            fila.innerHTML = `
                    <td style="padding: 10px;">${secc.seccionromano}</td>
                    <td style="text-align: left; padding: 10px; font-size: 18px">${secc.descripcion}</td>
                    <td style="text-align: center; padding: 10px;">${porceCumpli}</td>
                `;
            tabla.appendChild(fila);
        }

        otraPagina.appendChild(tabla);
        contenido.appendChild(otraPagina);


        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir evaluacion de cumplimiento -  Riesgos de mercado
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        otraPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "3.3. Evaluación del Cumplimiento - Riesgos de Mercado";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        otraPagina.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Tiene otro formato...Habría que normalizarlo....";
        // Crear la imagen
        imagen = document.createElement('img');
        imagen.src = '../img/mercado.png';  // Reemplaza con la URL o ruta de la imagen
        imagen.alt = 'Descripción de la imagen';
        imagen.style.display = 'block';  // Para asegurarse de que quede en una línea nueva
        imagen.style.marginTop = '10px'; // Espacio entre el párrafo y la imagen
        imagen.style.width = '500px';    // Ajusta el tamaño según necesites

        otraPagina.appendChild(parrafo);
        otraPagina.appendChild(imagen);

        contenido.appendChild(otraPagina);


        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir evaluacion de cumplimiento -  Riesgos de procesos
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        otraPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "3.4 Evaluación del Cumplimiento - Riesgos de Procesos";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '3mm';
        otraPagina.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Texto descriptivo...<br>";
        otraPagina.appendChild(parrafo);


        // crea la tabla de totales por capitulo
        capitulo = "D";
        secciones = await leerSecciones(idioma, capitulo);
        respuestas = await leerRespuestas(CUIT, capitulo);

        // Crear la tabla si no existe
        tabla = document.createElement("table");
        tabla.style.width = "90%";
        tabla.style.borderCollapse = "collapse";

        // Agregar encabezado (opcional)
        encabezado = document.createElement("tr");
        encabezado.innerHTML = `
                <th style="text-align: center; padding: 5px;">#</th>
                <th style="text-align: left; padding: 15px;">Sección</th>
                <th style="text-align: center; padding: 5px;">%</th>
            `;
        tabla.appendChild(encabezado);

        // Llenar la tabla con datos
        for (const secc of secciones.records) {
            const porceCumpli = respuestas.records.find(c => c.seccion === secc.seccion)?.porcentaje || 999;
            if (porceCumpli === 999) { continue };
            const fila = document.createElement("tr");
            fila.classList.add("situacion2");

            const color = porceCumpli < 60.0 ? 'red' : 'black'; // Podés elegir otro color si querés

            fila.innerHTML = `
                <td style="height: 10px; padding: 0px 5px; font-size: 17px; line-height: 1.9;">${secc.seccionromano}</td>
                <td style="text-align: left; font-size: 16px; padding: 0px 5px; line-height: 1.9; color: ${color};">${secc.descripcion}</td>
                <td style="text-align: center; font-size: 16px; padding: 0px 5px; line-height: 1.9; color: ${color};">${porceCumpli}</td>
            `;
            tabla.appendChild(fila);
        }

        otraPagina.appendChild(tabla);
        contenido.appendChild(otraPagina);


        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir evaluacion de cumplimiento -  Financiero
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        otraPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "3.5 Evaluación del Cumplimiento - Sistema Financiero";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        otraPagina.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Texto descriptivo...Tiene otro formato.  Habría que tratar de normalizarlo.";
        // Crear la imagen
        imagen = document.createElement('img');
        imagen.src = '../img/financiero.png';  // Reemplaza con la URL o ruta de la imagen
        imagen.alt = 'Descripción de la imagen';
        imagen.style.display = 'block';  // Para asegurarse de que quede en una línea nueva
        imagen.style.marginTop = '10px'; // Espacio entre el párrafo y la imagen
        imagen.style.width = '500px';    // Ajusta el tamaño según necesites

        otraPagina.appendChild(parrafo);
        otraPagina.appendChild(imagen);

        contenido.appendChild(otraPagina);

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir evaluacion de cumplimiento -  Financiero
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        otraPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "3.6 Evaluación del Cumplimiento - Generación de Resultados";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        otraPagina.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.4';
        parrafo.innerHTML = "Texto descriptivo...Tiene otro formato igual que financiero....";
        // Crear la imagen
        imagen = document.createElement('img');
        imagen.src = '../img/financiero.png';  // Reemplaza con la URL o ruta de la imagen
        imagen.alt = 'Descripción de la imagen';
        imagen.style.display = 'block';  // Para asegurarse de que quede en una línea nueva
        imagen.style.marginTop = '10px'; // Espacio entre el párrafo y la imagen
        imagen.style.width = '500px';    // Ajusta el tamaño según necesites

        otraPagina.appendChild(parrafo);
        otraPagina.appendChild(imagen);

        contenido.appendChild(otraPagina);

        console.log("pagina 3.6. Resultados")

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir la cuarta página (contenido) con un borde
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        const cuartaPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "4. Aplicación del Modelo HexaRCi y Conclusiones";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        cuartaPagina.appendChild(parrafo);

        parrafo2 = document.createElement('p');
        parrafo2.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo2.style.fontSize = '13pt';
        parrafo2.style.lineHeight = '1.5';
        parrafo2.style.fontStyle = 'normal'; // Agregar estilo itálico
        parrafo2.innerHTML = "De acuerdo con la información cargada por <strong><span class='company-name' style='font-size: 16px'>BDT Advisory </span></strong> y a los parámetros del Modelo HexaRCi, la Compañia <strong><span class='company-name' style='font-size: 16px'>BDT Advisory </span></strong> es una compañia calificada preliminarmente como tipo:"
        cuartaPagina.appendChild(parrafo2);

        const resultado = document.createElement('p');
        resultado.innerHTML = tipificacion;
        resultado.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        resultado.style.fontSize = '16pt';
        resultado.style.fontWeight = 'bold';
        resultado.style.textAlign = 'center';
        resultado.style.marginTop = '7mm';
        cuartaPagina.appendChild(resultado);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.5';
        parrafo.innerHTML = 'BDT ADVISORY ' + textoTipificacion;
        cuartaPagina.appendChild(parrafo);

        contenido.appendChild(cuartaPagina);

        console.log("pagina 4 Aplicacion Modelo")

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir la quinta página dibuho hexagono
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

        const quintaPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "5. Representación gráfica";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        quintaPagina.appendChild(parrafo);

        function crearContenidoPDF() {

            // Crear canvas para el hexágono
            const hexagonoCanvas = document.createElement('canvas');
            hexagonoCanvas.id = 'hexagonoPDF';
            hexagonoCanvas.width = 700;
            hexagonoCanvas.height = 700;
            hexagonoCanvas.style.maxWidth = '100%';
            hexagonoCanvas.style.height = 'auto';

            // Contexto del canvas
            const ctx = hexagonoCanvas.getContext('2d');

            // Variables para el hexágono
            const var1 = 59.91, var2 = 89.50, var3 = 59.09, var4 = 72.64, var5 = 63.00, var6 = 41.36;
            const variablesHexagono = [var1, var2, var3, var4, var5, var6];

            const rotulosHexagono = [
                'Gobierno Corporativo',
                'Apetito Riesgo',
                'Riesgos Mercado',
                'Riesgos Procesos',
                'Situación Financiera',
                'Generación Resultados'
            ];

            const centerX = hexagonoCanvas.width / 2;
            const centerY = hexagonoCanvas.height / 2;
            const radioMax = 170;
            const radio90 = radioMax * 0.9;
            const radio70 = radioMax * 0.7;
            const radio50 = radioMax * 0.5;

            ctx.clearRect(0, 0, hexagonoCanvas.width, hexagonoCanvas.height);

            // Dibujar hexágonos de fondo
            function dibujarHexagonoFondo(radio, color, strokeColor) {
                ctx.beginPath();
                for (let i = 0; i < 6; i++) {
                    const angulo = (i * Math.PI) / 3;
                    const x = centerX + radio * Math.cos(angulo);
                    const y = centerY + radio * Math.sin(angulo);

                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.fillStyle = color;
                ctx.fill();
                ctx.strokeStyle = strokeColor;
                ctx.stroke();
            }

            // Dibujar hexágonos de fondo
            dibujarHexagonoFondo(radioMax, 'rgba(173, 216, 230, 0.7)', 'black');
            dibujarHexagonoFondo(radio90, 'rgba(0, 255, 0, 0.7)', 'green');
            dibujarHexagonoFondo(radio70, 'rgba(255, 255, 0, 0.7)', 'yellow');
            dibujarHexagonoFondo(radio50, 'rgba(255, 0, 0, 0.9)', 'red');

            // Dibujar líneas desde el centro
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const x = centerX + radioMax * Math.cos(angulo);
                const y = centerY + radioMax * Math.sin(angulo);

                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
            }
            ctx.strokeStyle = 'gray';
            ctx.stroke();

            // Dibujar área de variables
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const porcentaje = variablesHexagono[i] / 100;
                const radio = radioMax * porcentaje;
                const x = centerX + radio * Math.cos(angulo);
                const y = centerY + radio * Math.sin(angulo);

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fillStyle = 'rgba(0, 150, 255, 0.7)';
            ctx.fill();
            ctx.strokeStyle = 'blue';
            ctx.stroke();

            // Agregar valores de variables
            ctx.font = '17px Arial, strong';
            ctx.fillStyle = 'black';
            variablesHexagono.forEach((valor, i) => {
                const angulo = (i * Math.PI) / 3;
                const porcentaje = valor / 100;
                const radioTexto = radioMax * porcentaje * 0.9;
                const xTexto = centerX + radioTexto * Math.cos(angulo);
                const yTexto = centerY + radioTexto * Math.sin(angulo);
                ctx.fillText(`${valor}%`, xTexto - 15, yTexto + 5);
            });

            // Agregar rótulos
            ctx.font = '15px Arial, strong';
            ctx.fillStyle = 'black';
            rotulosHexagono.forEach((rotulo, i) => {
                const angulo = (i * Math.PI) / 3;
                const xRotulo = centerX + (radioMax + 20) * Math.cos(angulo);
                const yRotulo = centerY + (radioMax + 20) * Math.sin(angulo);
                const palabras = rotulo.split(' ');

                if (i === 3) {
                    ctx.fillText(palabras[0], xRotulo - 35, yRotulo - 5);
                    ctx.fillText(palabras[1], xRotulo - 35, yRotulo + 14);
                } else {
                    ctx.fillText(palabras[0], xRotulo - 18, yRotulo - 5);
                    ctx.fillText(palabras[1], xRotulo - 18, yRotulo + 14);
                }
            });

            // Contenedor para la imagen del canvas
            const canvasContainer = document.createElement('div');
            canvasContainer.style.width = '100%';
            canvasContainer.style.display = 'flex';
            canvasContainer.style.justifyContent = 'center';
            canvasContainer.style.marginTop = '20px';

            // Convertir canvas a imagen
            const imagenHexagono = document.createElement('img');
            imagenHexagono.src = hexagonoCanvas.toDataURL('image/png');
            imagenHexagono.style.maxWidth = '100%';
            imagenHexagono.style.height = 'auto';

            canvasContainer.appendChild(imagenHexagono);
            quintaPagina.appendChild(canvasContainer);
            // contenido.appendChild(quintaPagina);

            return contenido;
        }

        crearContenidoPDF();

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.5';
        parrafo.innerHTML = "Si cada factor alcanzare el 100% se conformaría un 'Hexágono perfecto' y de esa manera <strong><span class='company-name' style='font-size: 16px'></span></strong> se constituiría en una empresa competitiva de acuerdo con el Modelo HexaRCi.<br><br>Consecuentemente se debe construir una estrategia de mejora adaptada a las características y particularidades de <strong><span class='company-name' style='font-size: 16px'>BDT ADVISORY</span></strong>, de forma que mediante un proceso de mejora continua en el manejo de los riesgos se la prepare para ir alcanzando el 'Hexágono Perfecto'";
        quintaPagina.appendChild(parrafo);

        contenido.appendChild(quintaPagina);
        console.log("pagina 5. Dibujito")

        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir la sexta pagina presenta mejoras
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        const sextaPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.innerHTML = "6. Recomendaciones.  Oportunidades de mejora";
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '16pt';
        parrafo.style.fontWeight = 'bold';
        parrafo.style.textAlign = 'left';
        parrafo.style.marginTop = '5mm';
        sextaPagina.appendChild(parrafo);

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '13pt';
        parrafo.style.lineHeight = '1.5';
        parrafo.innerHTML = "El análisis realizado a través del Modelo HEXARCi mediante la valoración otorgada a cada situación, ha permitido identificar diversas oportunidades de mejora en la gestión de riesgos. El adecuado tratamiento de estas oportunidades puede fortalecer sus procesos y estrategias para una gestión más eficiente y proactiva.<br><br>Al implementar medidas correctivas o de optimización, se logrará reducir la brecha entre la situación actual de la organización y el estado ideal, mejorando su capacidad de respuesta ante posibles riesgos y fortaleciendo su sostenibilidad a largo plazo.<br><br>Los aspectos a mejorar más significativos en cada factor de riesgo:<br><br> ♦ Manejo de los Riesgos de Gobierno Corporativo (MRG);<br><br> ♦ Manejo de los Riesgos del Apetito de Riesgo (MAR);<br><br> ♦ Manejo de los Riesgos de Mercado (MRM) y<br><br> ♦ Manejo de los Riesgos de los Procesos<br><br>se exponen a continuación:";
        sextaPagina.appendChild(parrafo);

        contenido.appendChild(sextaPagina);

        console.log("pagina 6. Recomendaciones")
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir paginas con mejoras
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

        capitulos = await leeCapitulos();
        // console.log(capitulos)
        let alturaMaxima = 40;
        let alturaActual = 0;

        for (const capitulo of capitulos) {
            if (capitulo.letra == "E" || capitulo.letra == "F") {
                continue;
            }

            matrizPreguntas = await recuperarPreguntas(capitulo.letra);

            let mejorasPagina = crearPaginaConMarco();

            parrafo = document.createElement('p');
            parrafo.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
            parrafo.style.fontSize = '16pt';
            parrafo.style.fontWeight = 'bold';
            parrafo.style.textAlign = 'center';
            parrafo.style.marginTop = '5mm';

            // Crear el título del capítulo ::::::::::::::::::::::::::.
            // let titulo = document.createElement("h3");
            parrafo.innerHTML = `Factor: ${capitulo.nombre}`;
            // contenedor.appendChild(titulo);
            mejorasPagina.appendChild(parrafo);

            // contenedor.appendChild(titulo);
            parrafo = document.createElement('p');
            parrafo.style.marginTop = '15px';
            parrafo.style.fontSize = '13pt';
            parrafo.innerHTML = 'Las declaraciones presentadas a continuación han sido informadas como incumplidas o no cumplidas satisfactoriamente: ';
            mejorasPagina.appendChild(parrafo);

            // Busca las respuestas de ese capítulo
            const data = await buscaRespuesta(CUIT, capitulo.letra);
            // console.log(`cuit ${CUIT}, capitulo ${capitulo.letra}`)
            const respuestas = data.respuestas || []; // Si no hay respuestas, asigna un array vacío
            // console.log(respuestas)

            // Crear el encabezado (seccion):::::::::::::::::::::::::::
            for (const respuesta of respuestas) {
                if (respuesta.porcentaje > max) { // descarta capitulo
                    continue;
                }

                const existeTipo = matrizPreguntas.some(
                    (p) =>
                        p.Capitulo == respuesta.capitulo &&
                        p.Seccion == respuesta.seccion &&
                        (p.tipo == 1 || p.tipo == 52)
                );

                if (!existeTipo) { // No hay 1 o 52 en matrizPreguntas para seccion
                    continue; // Salta a la siguiente iteración del bucle
                }

                const indice = respuesta.seccion;
                const descripcion = await obtenerNombreSeccion(
                    indice,
                    idioma,
                    capitulo.letra
                );

                const descripcionElemento = document.createElement('div');
                descripcionElemento.style.fontSize = "15px";
                descripcionElemento.style.borderRadius = "8px";
                descripcionElemento.style.marginTop = "15px"; // Agrega espacio arriba
                descripcionElemento.style.padding = "10px"; // Espacio interno entre el borde y el texto

                if (capitulo.letra == "A") {
                    descripcionElemento.style.backgroundColor = "#FAF0E6";
                }
                if (capitulo.letra == "B") {
                    descripcionElemento.style.backgroundColor = "#F0E68C";
                }
                if (capitulo.letra == "C") {
                    descripcionElemento.style.backgroundColor = "#D3D3D3";
                }
                if (capitulo.letra == "D") {
                    descripcionElemento.style.backgroundColor = "#F0F8FF";
                }
                descripcionElemento.innerHTML = "[ " + respuesta.porcentaje + " % ]  -  Sección: " + respuesta.seccion + ". " + descripcion;
                mejorasPagina.appendChild(descripcionElemento);

                // Obtener la altura real del elemento después de agregarlo al DOM
                // let alturaElemento = descripcionElemento.offsetHeight;
                // console.log(`altura titulo ${alturaElemento}`)
                // alturaActual += alturaElemento;
                alturaActual += 3;

                // contenido.appendChild(mejorasPagina);

                // Crear el cuerpo de la tabla::::::::::::::::::::::::::::::
                let info = respuesta.seccion;
                let preguntasSeccion = matrizPreguntas.filter( //  Filtra las preguntas para la seccion seleccionada
                    (pregunta) => pregunta.Seccion == info
                );

                // itera por todas las preguntas filtradas
                for (const pregunta of preguntasSeccion) {
                    let filaSeccion = document.createElement("tr");
                    filaSeccion.classList.add("situacion2");

                    let filaRespuesta = document.createElement("div");
                    filaRespuesta.classList.add("situacion2");

                    let renglon = document.createElement("div");
                    renglon.textContent = pregunta.Numero + " - " + pregunta.Descrip;
                    renglon.style.marginLeft = "15px"; // Agrega espacio 
                    renglon.style.marginTop = "5px"; // Agrega espacio 
                    filaRespuesta.appendChild(renglon);

                    poneRespuesta(respuesta, pregunta).then((texto) => {
                        if (
                            (pregunta.tipo == "52" && (texto == "No efectivo" || texto == "Poco efectivo")) ||
                            (pregunta.tipo == "1" && texto == "NO")) {
                            mejorasPagina.appendChild(filaRespuesta);

                            const textoCompleto = renglon.textContent || renglon.innerText;
                            const lineasEstimadas = estimarLineasPorCaracteres(textoCompleto, 80);
                            alturaActual += lineasEstimadas;
                            console.log("puso recomendación")
                        }

                        function estimarLineasPorCaracteres(texto, caracteresPromedioPorLinea) {
                            // Remover HTML si hay
                            const textoPlano = texto.replace(/<[^>]*>/g, '');
                            return Math.ceil(textoPlano.length / caracteresPromedioPorLinea);
                        }

                        // Si la altura acumulada excede el límite, crear nueva hoja
                        if (alturaActual >= alturaMaxima) {
                            mejorasPagina = crearPaginaConMarco();
                            alturaActual = 0; // Reiniciar el contador de altura
                        };

                    })
                    contenido.appendChild(mejorasPagina);
                }
            }
        }

        // Generar PDF directamente
        html2pdf().from(contenido).set(opciones).save("Informe HexaRCi.pdf")
            .catch(error => {
                console.error("Error generando PDF:", error);
            });

        document.getElementById("loader").style.display = "none";
        document.getElementById("formularioFinal").style.display = "none";
        document.getElementById("formularioSaludo").style.display = "block";
    }


    function crearPaginaConMarco(textoLateral, numeroPagina, marcaElemento, clienteElemento) {
        const pagina = document.createElement('div');
        pagina.style.padding = '10mm';
        pagina.style.margin = '10mm';
        pagina.style.border = '2px solid #000';
        pagina.style.boxShadow = '0 0 10mm rgba(0,0,0,0.1)'; // Sombra suave
        pagina.style.minHeight = '240mm';
        pagina.style.borderRadius = '5mm';
        pagina.style.position = 'relative'; // Para posicionar elementos internos
        pagina.style.pageBreakAfter = 'always'; // Salto de página después
        numPagina++;
        numeroPagina = numPagina;
        marcaElemento = "BDT Advisory";
        clienteElemento = empresa;
        textoLateral = "Autoevaluación"
        // Si se proporciona texto lateral
        if (textoLateral) {
            const textoLateralElemento = document.createElement('div');
            textoLateralElemento.textContent = textoLateral;
            textoLateralElemento.style.position = 'absolute';
            textoLateralElemento.style.left = '85%'; // centrado horizontalmente
            textoLateralElemento.style.top = '-3%'; // centrado verticalmente
            textoLateralElemento.style.transform = 'translateX(-50%, -50%)';
            textoLateralElemento.style.transformOrigin = 'left center';
            // textoLateralElemento.style.bottom = '-200px'; // Ajusta este valor según necesites
            textoLateralElemento.style.whiteSpace = 'nowrap';
            textoLateralElemento.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
            textoLateralElemento.style.fontSize = '10pt';
            textoLateralElemento.style.color = '#666'; // Color gris para mayor visibilidad
            // textoLateralElemento.style.opacity = '0.8'; // Semi-transparente

            pagina.appendChild(textoLateralElemento);
        }

        // Número de página
        if (numeroPagina !== undefined) {
            const paginaNumero = document.createElement('div');
            paginaNumero.textContent = `Página ${numeroPagina}`;
            paginaNumero.style.position = 'absolute';
            paginaNumero.style.left = '50%';
            paginaNumero.style.transform = 'translateX(-50%)';
            paginaNumero.style.bottom = '-20px'; // Ajusta según necesites
            paginaNumero.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
            paginaNumero.style.fontSize = '10pt';
            paginaNumero.style.color = '#666';

            pagina.appendChild(paginaNumero);

        }
        //  marca BDT Advisory
        if (marcaElemento !== undefined) {
            const marca = document.createElement('div');
            marca.textContent = marcaElemento;
            marca.style.position = 'absolute';
            marca.style.left = '10%';
            marca.style.transform = 'translateX(-50%)';
            marca.style.bottom = '-20px'; // Ajusta según necesites
            marca.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
            marca.style.fontSize = '10pt';
            marca.style.color = '#666';

            pagina.appendChild(marca);
        }

        if (clienteElemento !== undefined) {
            const cliente = document.createElement('div');
            cliente.textContent = clienteElemento;
            cliente.style.position = 'absolute';
            cliente.style.top = '-3%'; // centrado verticalmente
            cliente.style.left = '10%';
            cliente.style.transform = 'translateX(-50%)';
            cliente.style.bottom = '-20px'; // Ajusta según necesites
            cliente.style.fontFamily = 'Abel, Helvetica, Arial, sans-serif';
            cliente.style.fontSize = '10pt';
            cliente.style.color = '#666';

            pagina.appendChild(cliente);
        }

        return pagina;
    }

    /* ----------------------------------------- */
    /*           lee Capitulos
    /* ----------------------------------------- */
    async function leeCapitulos() {
        try {
            const respuesta = await fetch(`/capitulos?idioma=${idioma}`);
            if (respuesta.ok) {
                const capitulos = await respuesta.json();
                return capitulos;
            } else {
                console.error("Error al obtener los datos");
            }
        } catch (error) {
            console.error("Error al realizar la solicitud:", error);
        }
        return false;
    }

    // -----------------------------------------
    //   recuperarPreguntas          
    /* ----------------------------------------- */
    async function recuperarPreguntas(capitulo) {
        try {
            let url = "/preguntas";
            if (capitulo !== null) {
                url += `?capitulo=${encodeURIComponent(capitulo)}`;
            }

            const response = await fetch(url);
            if (response.ok) {
                const result = await response.json(); // Procesa la respuesta como JSON
                // console.log("termino lectura preguntas");
                return Array.isArray(result) ? result : []; // Asegura devolver un arreglo
            } else {
                console.error("Error al obtener las preguntas:", response.statusText);
                return [];
            }
        } catch (error) {
            console.error("Error al realizar la solicitud:", error);
            return [];
        }
    }

    /* -----------------------------------------
    //     buscaRespuesta    
    /* ----------------------------------------- */
    async function buscaRespuesta(CUIT, capitulo) {
        try {
            const response = await fetch(
                `/busca-respuesta-capitulo-ordenado?CUIT=${CUIT}&capitulo=${capitulo}`
            );
            if (!response.ok) {
                throw new Error("Respuesta no OK de buscaRespuesta");
            }

            const resultado = await response.json();
            return { exists: resultado.exists, respuestas: resultado.records || [] };
        } catch (error) {
            console.error("Error al realizar la solicitud en buscaRespuesta:", error);
            return { exists: false, respuestas: [] };
        }
    }

    /* -----------------------------------------
    obtenerNombreSeccion
    /* ----------------------------------------- */
    async function obtenerNombreSeccion(indice, idioma, capitulo) {
        try {
            const response = await fetch(
                `/secciones?indice=${indice}&idioma=${idioma}&capitulo=${capitulo}`
            );
            if (!response.ok) {
                throw new Error(`Error en la solicitud: ${response.statusText}`);
            }

            const data = await response.json();
            if (data.length > 0) {
                return data[0].descripcion;
            } else {
                return "Descripción no disponible";
            }
        } catch (error) {
            console.error(
                `para leer indice ${indice}, idioma ${idioma}, capitulo ${capitulo}`
            );
            console.error("Error al obtener la descripción:", error);
            return "Descripción no disponible";
        }
    }

    /* -----------------------------------------
    poneRespuesta
    /* ----------------------------------------- */
    async function poneRespuesta(respuesta, pregunta) {
        // recupera la respuesta segun el numero de pregunta....;
        const registroRespuestasSeccion = respuesta; //es el arreglo de respuestas para todas las preguntas de la seccion)
        let arrayRespuestas = registroRespuestasSeccion.respuesta;

        valorRespuesta = arrayRespuestas[pregunta.Numero - 1]; // resta 1 por la posición 0

        // segun el tipo de respuesta (en pregunta.tipo) se convierte para mostrar
        // tipo 1:  1: si,  2: no
        if (pregunta.tipo == 1) {
            if (valorRespuesta == 1) {
                return "SI";
            } else {
                return "NO";
            }
        }

        if (pregunta.tipo == 3) {
            return valorRespuesta;
        }

        if (pregunta.tipo == 51) {
            const registroTextoRespuestas = textoRespuestas.find(
                (item) => item.pregunta == pregunta.tipo
            );
            return registroTextoRespuestas.textos[valorRespuesta - 1];
        }

        if (pregunta.tipo > 50) {
            try {
                const registroTextoRespuestas = textoRespuestas.find(
                    (registro) => registro.pregunta === pregunta.tipo
                );
                if (!registroTextoRespuestas) {
                    console.error(
                        `No se encontró un registro con pregunta igual a ${pregunta.tipo}`
                    );
                }
                valorRespuesta = arrayRespuestas[pregunta.Numero - 1]; // resta 1 por la posición 0
                if (valorRespuesta == "9") {
                    return "No aplica";
                } else {
                    const texto = registroTextoRespuestas.textos[valorRespuesta - 1];
                    return texto;
                }
            } catch (error) {
                console.error("Error procesando bloque para pregunta.tipo > 50:", error);
            }
        }

        if (pregunta.tipo > 40 && pregunta.tipo < 50) {
            let indicesCheck = 0;
            const registroTextoCheck = textoCheck.find(
                (item) => item.pregunta == pregunta.tipo
            );
            if (!registroTextoCheck) {
                console.log(
                    "No se encontró ninguna fila con la pregunta:",
                    pregunta.tipo
                );
                return;
            }
            valorRespuesta = arrayRespuestas[pregunta.Numero - 1]; // resta 1 por la posición 0
            const valoresTextoCheck = registroTextoCheck.textos;
            // console.log(`registro Respuestas seccion  ${registroRespuestasSeccion.respuesta}`);
            if (pregunta.tipo == 42 || pregunta.tipo == 43) {
                arrayRespuestas = registroRespuestasSeccion.respuesta;
            } else {
                arrayRespuestas = registroRespuestasSeccion.respuesta[6];
            }
            // console.log(`array rsepuestas  ${arrayRespuestas}`)
            let conjunto = "";
            arrayRespuestas.forEach((indice, i) => {
                const texto = valoresTextoCheck[indice - 1]; // Obtener el texto correspondiente al índice
                if (i > 0) {
                    conjunto += ", "; // Agregar una coma y un espacio antes de cada texto (excepto el primero)
                }
                conjunto += texto;
            });
            return conjunto;
        }
    }

    /* -----------------------------------------
    leeTextoCheck          
    /* ----------------------------------------- */
    async function leeTextoCheck() {
        try {
            const response = await fetch("/textocheck");
            if (response.ok) {
                const result = await response.json();
                return Array.isArray(result) ? result : []; // Asegura devolver un arreglo
            } else {
                console.error("Error al obtener las preguntas:", response.statusText);
                return [];
            }
        } catch (error) {
            console.error("Error al realizar la solicitud:", error);
            return [];
        }
    }

    /* -----------------------------------------
    leeTextoRespuestas         
    /* ----------------------------------------- */
    async function leeTextoRespuestas() {
        try {
            const response = await fetch("/textorespuestas");
            if (response.ok) {
                const result = await response.json();
                // console.log("Datos recibidos de /textorespuestas:", result); // Verifica la estructura aquí
                return Array.isArray(result) ? result : []; // Asegura devolver un arreglo
            } else {
                console.error("Error al obtener las preguntas:", response.statusText);
                return [];
            }
        } catch (error) {
            console.error("Error al realizar la solicitud:", error);
            return [];
        }
    }


    // :::::::::::::::::::::::::::::::::::::::::::::::
    //                                  leeCapitulos
    // :::::::::::::::::::::::::::::::::::::::::::::::
    async function leeCapitulos() {
        try {
            const respuesta = await fetch(`/capitulos?idioma=${idioma}`);
            if (respuesta.ok) {
                const capitulos = await respuesta.json();
                return capitulos;
            } else {
                console.error("Error al obtener los datos");
            }
        } catch (error) {
            console.error("Error al realizar la solicitud:", error);
        }
        return false;
    }

    // :::::::::::::::::::::::::::::::::::::::::::::::
    //                          obtenerTotalCapitulos
    // :::::::::::::::::::::::::::::::::::::::::::::::
    async function obtenerTotalCapitulos(CUIT) {
        try {
            const response = await fetch(`/totalCapitulos?CUIT=${CUIT}`);
            if (response.ok) {
                const data = await response.json();
                return data; // Devuelve los datos obtenidos si la respuesta es exitosa
            } else {
                console.error(
                    "Error en la respuesta:",
                    response.status,
                    response.statusText
                );
                return null;
            }
        } catch (error) {
            console.error("Error en la solicitud:", error);
            return null;
        }
    }

    // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
    //                  leerSecciones
    // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
    async function leerSecciones(idioma, capitulo) {
        try {
            const response = await fetch(`/secciones?idioma=${idioma}&capitulo=${capitulo}`);
            if (response.ok) {
                const seccionRec = await response.json(); //registro seccion recibido en formato JSON
                return { exists: true, records: seccionRec };
            } else {
                console.error("Error al obtener los datos");
                return [];
            }
        } catch (error) {
            console.error("Error al realizar la solicitud:", error);
        }
        return false;
    }

    // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
    //             leerRespuestas
    // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
    async function leerRespuestas(CUIT, capitulo) {
        try {
            // console.time("Tiempo de busca Respuesta cuit, capit");
            const response = await fetch(
                `/busca-respuesta-capitulo?CUIT=${CUIT}&capitulo=${capitulo}`
            );
            if (response.ok) {
                const result = await response.json();
                if (result.exists) {
                    return { exists: true, records: result.records };
                }
            } else {
                console.error(`Sin respuesta para lectura seccion en capitulo ${capitulo} en buscaRespuesta`);
            }
        } catch (error) {
            console.error("Error al realizar la solicitud en buscaRespuesta:", error);
        }
        return { exists: false };
    }



</script>

</html>