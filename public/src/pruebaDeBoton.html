<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablas Dinámicas con Botones</title>
    <style>
        table {
            width: 45%;
            border-collapse: collapse;
            margin: 10px;
            display: inline-block;
            vertical-align: top;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        #dialog {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #dialog button {
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <!-- <h1>Situaciones NO EFECTIVAS</h1>
    <p class="pconclusiones">Los elementos que se encuentran en esta categoría han obtenido una puntuación que no ha logrado superar el 50% de la puntuación ideal. Estos aspectos requieren una atención prioritaria, ya que su falta de efectividad podría comprometer el cumplimiento de nuestras metas estratégicas y la buena gobernanza en la organización. Es fundamental identificar las causas de esta baja performance y desarrollar planes de mejora específicos.</p>
    <table id="table1" style="width: 510px">
      <thead>
        <tr>
          <th id="namePlayer" rowspan="2" style="position:sticky; left:0;">Sección</th>
          <th colspan="4">Calificación: 0 - 50%</th>
        </tr>
        <tr>
          <th>Ideal</th>
          <th>Obtenida</th>
          <th>%</th>
          <th>Ver</th>
        </tr>
      </thead>
      <tbody id="questionsTableBody">
      </tbody>
    </table>
    <br>
    <h1>Tablas Dinámicas</h1> -->
    
    <!-- Primera tabla -->
    <h2>Situaciones NO EFECTIVAS</h2>
    <p class="pconclusiones">Los elementos que se encuentran en esta categoría han obtenido una puntuación que no ha logrado superar el 50% de la puntuación ideal. Estos aspectos requieren una atención prioritaria, ya que su falta de efectividad podría comprometer el cumplimiento de nuestras metas estratégicas y la buena gobernanza en la organización. Es fundamental identificar las causas de esta baja performance y desarrollar planes de mejora específicos.</p>
    <table id="table1" style="width: 510px">
    <table id="table1">
        <thead>
            <tr>
                <th id="namePlayer" rowspan="2" style="position:sticky; left:0;">Sección</th>
                <th colspan="3">Calificación: 0 - 50%</th>
            </tr>
            <tr>
                <th>Columna 1</th>
                <th>Columna 2</th>
                <!-- <th>Columna 3</th> -->
                <th>Acción</th>
            </tr>
        </thead>
        <tbody id="table1Body">
            <!-- Las filas se generarán aquí -->
        </tbody>
    </table>
    
    <!-- Segunda tabla -->
    <h2>Tabla 2</h2>
    <table id="table2">
        <thead>
            <tr>
                <th>Columna A</th>
                <th>Columna B</th>
                <th>Columna C</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody id="table2Body">
            <!-- Las filas se generarán aquí -->
        </tbody>
    </table>
    
    <!-- Cuadro de diálogo -->
    <div id="dialog">
        <p id="dialogMessage"></p>
        <button onclick="closeDialog()">Cerrar</button>
    </div>
    
    <script>
let tablaMenuEs = [];
let tablaMenuA = [];
let primeraVez = 0;
const apellidouser = localStorage.getItem("apellido");
const nombreUser = localStorage.getItem("nombre");
const apenom = nombreUser + ' ' + apellidouser;
const empresa = localStorage.getItem("empresa");
const CUIT = localStorage.getItem("CUIT");
const capitulo = "A";
const idioma = Number(localStorage.getItem('idioma'))
let totalMax = 0;
let totalCal = 0;
let matrizPreguntas = [];

ejecutarProceso();

async function ejecutarProceso() {
  matrizPreguntas = await recuperarPreguntas();
//   buscaPrintResultados(CUIT, capitulo);
    console.log(matrizPreguntas)
    respuestas = await buscaRespuesta(CUIT, capitulo);
    console.log(respuestas)
  
}

async function recuperarPreguntas() {
  try {
    const response = await fetch("/preguntas");
    if (response.ok) {
      const result = await response.json();
      return Array.isArray(result) ? result : []; // Asegura devolver un arreglo
    } else {
      console.error("Error al obtener las preguntas:", response.statusText);
      return [];
    }
  } catch (error) {
    console.error("Error al realizar la solicitud:", error);
    return [];
  }
}

async function buscaRespuesta(CUIT, capitulo) {
  try {
    const response = await fetch(
      `/busca-respuesta-capitulo-ordenado?CUIT=${CUIT}&capitulo=${capitulo}`
    );
    if (!response.ok) {
      throw new Error('Respuesta no OK de buscaRespuesta');
    }

    const resultado = await response.json();
    return { exists: resultado.exists, respuestas: resultado.records || []};
    
  } catch (error) {
    console.error("Error al realizar la solicitud en buscaRespuesta:", error);
    return { exists: false, respuestas: [] };
  }
}

        // Datos de ejemplo para la primera tabla
        const data1 = [
            ['Fila 1A, Col 1', 'Fila 1A, Col 2', 'Fila 1A, Col 3'],
            ['Fila 2A, Col 1', 'Fila 2A, Col 2', 'Fila 2A, Col 3'],
            ['Fila 3A, Col 1', 'Fila 3A, Col 2', 'Fila 3A, Col 3']
        ];
        
        // Datos de ejemplo para la segunda tabla
        const data2 = [
            ['Fila 1B, Col A', 'Fila 1B, Col B', 'Fila 1B, Col C'],
            ['Fila 2B, Col A', 'Fila 2B, Col B', 'Fila 2B, Col C'],
            ['Fila 3B, Col A', 'Fila 3B, Col B', 'Fila 3B, Col C'],
            ['Fila 4B, Col A', 'Fila 4B, Col B', 'Fila 4B, Col C']
        ];

        // Función para generar una tabla
        function generateTable(tableId, data) {
            const tableBody = document.getElementById(tableId);

            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });

                const actionTd = document.createElement('td');
                const button = document.createElement('button');
                button.textContent = 'Mostrar Fila';
                button.onclick = () => showDialog(index + 1); // Mostrar número de fila (index + 1)
                actionTd.appendChild(button);
                tr.appendChild(actionTd);

                tableBody.appendChild(tr);
            });
        }

        // Función para mostrar el cuadro de diálogo
        function showDialog(rowNumber) {
            const dialog = document.getElementById('dialog');
            const dialogMessage = document.getElementById('dialogMessage');
            dialogMessage.textContent = `Número de fila: ${rowNumber}`;
            dialog.style.display = 'block';
        }

        // Función para cerrar el cuadro de diálogo
        function closeDialog() {
            const dialog = document.getElementById('dialog');
            dialog.style.display = 'none';
        }

        // Genera las tablas cuando la página esté completamente cargada
        document.addEventListener('DOMContentLoaded', () => {
            generateTable('table1Body', data1);
            generateTable('table2Body', data2);
        });
    </script>
</body>
</html>
