<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación de riesgos</title>
    <script src="https://cdn.jsdelivr.net/npm/gaugeJS/dist/gauge.min.js"></script>
    <link href="../estilos/estiloSituacionFinanciera.css" rel="stylesheet">
    <!-- <link href="css/st-gobCorpo.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  
    <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Abel&family=Barlow+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Courgette&family=Gupter:wght@400;500;700&family=PT+Sans+Narrow:wght@400;700&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Serif:ital,opsz,wght@0,8..144,100..900;1,8..144,100..900&display=swap" rel="stylesheet">
  
  

        <style>
            table {
                width: 95%;
                border-collapse: collapse;
                margin-bottom: 1em;
            }
            th, td {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: center;
            }
            th {
                background-color: #f4f4f4;
            }

            .checkbox-matriz {
                display: grid;
                grid-template-columns: repeat(2, 1fr); /* 3 columnas */
                gap: 5px;
            }

            .checkbox-item {
              padding: 5px;
            }

            .question-cell {
                text-align: left;
            }
            .option-input {
                margin-right: 5px;
            }
        </style>
    </head>
    <body class="menu-a-page mercado">
      <div class="survey-container">
        <section class="main">
          <section class="gobCorpo">
            <div class="header-container">
              <div class="header-center">
                <div id="nombreEmpresa" class="company-name"></div>
                <div id="nombreUsuario" class="user-name"></div>
              </div>
              <div class="nav-iconsxx">
                <h4> C - Manejo de los Riesgos de Mercado</h4>
              </div>
              <div class="nav-iconsxx">
                <h5> Autoevaluación</h5>
              </div>
            </div>
            <hr>
    
          <!-- <form id="formulario"> -->
              <form id="surveyForm">
<!--     
            <div class="center-container">
              <h4 class="tituloSeccion"><a href="Menu-D.html">XVIII - Innovación</a></h4>
            </div> -->
    
            <div class="salida">
              <p>Seleccione la opción que corresponda a su organización.</p>
              <button type="button" id="boton-salir">Salir</button>
            </div>
    
            <div id="overlay">
              <div id="ventanaSalida">
                <!-- <div class="confirm-modal" id="confirm-modal">-->
                <div class="confirm-box">
                  <p>La información registrada hasta el momento quedará almacenada. <br> Si sale de la aplicación, podrá
                    completar posteriormente los items faltantes.
                    <br>
                  </p>Confirme si desea 'Salir' de la aplicación o 'Continuar' con el registro de datos.</p>
                  <button id="confirm-yes">Salir</button>
                  <button id="confirm-no">Continuar</button><br>
                </div>
              </div>
            </div>


  <!-- <form id="checklist-form" action="/procesar" method="POST"> -->
  <table>
    <thead>
        <tr>
            <th>#</th>
            <th class="pregunta-col">Situación</th>
            <th class="respuesta-col">No efectivo</th>
            <th class="respuesta-col">Poco efectivo</th>
            <th class="respuesta-col">Efectivo</th>
            <th class="respuesta-col">Muy efectivo</th>
        </tr>
    </thead>
    <tbody id="questionsTableBody">
        <!-- Las preguntas se agregarán aquí dinámicamente -->
    </tbody>
</table>


  <h3>Factores que se han tenido en cuenta en la creación de la estrategia, para el corto y mediano plazo:</h3>
  <p>(Marque todos los que correspondan)</p>
  <form id="checklist-form" action="/procesar" method="POST">
    <div class="checkbox-matriz" id="checkbox-matriz">
      <!-- Los checkboxes se generarán dinámicamente aquí -->
    </div>

    <div class="centrado-flex">
      <button type="button" id="boton-enviar" onclick="resumenGeneral()">Enviar</button>
      </div>
      
      <div class="centrado-flex">
      <button type="button" id="boton-borrar" onclick="limpiarSelecciones()">Limpiar selecciones</button>
      </div>

    <button type="submit">Enviar</button>
  </form>

  <script>
    const responses = [];
    let puntajesIndividuales = [];
    let valores = 0;
    let precios = [];
    let respuestas = [];

        // Función para construir la tabla de preguntas
    function buildForm(questions) {
        const tableBody = document.getElementById('questionsTableBody');
        questions.forEach(question => {
            const row = document.createElement('tr');

        // Numero de pregunta
        const numeroCell = document.createElement('td');
        numeroCell.classList.add('question-cell');
        numeroCell.textContent = question.Numero;
        row.appendChild(numeroCell);

        // Columna de la pregunta
        const questionCell = document.createElement('td');
        questionCell.classList.add('question-cell');
        questionCell.textContent = question.Descrip;
        row.appendChild(questionCell);
                
        // Opciones
        for (let i = 1; i <= 4; i++) {
            const optionCell = document.createElement('td');
            
            const optionInput = document.createElement('input');
            optionInput.type = 'radio';
            optionInput.name = `question_${question.id}`;
            optionInput.value = i;
            optionInput.classList.add('option-input');
            optionInput.id = `q${question.id}_o${i}`;
            
            // Añadir el input directamente en la celda
            optionCell.appendChild(optionInput);
            row.appendChild(optionCell);
        }
        
        tableBody.appendChild(row);
    });
    }


  </script>


  <script>
  // Función para obtener las preguntas del servidor
  function cargarPrimerasPreguntas() {
      let url = '/preguntas';

      // Agregar parámetros a la URL si existen
      let capitulo = "C";
      let seccion = 1;
      if (capitulo || seccion) {
          url += `?${capitulo ? `capitulo=${encodeURIComponent(capitulo)}` : ''}${capitulo && seccion ? '&' : ''}${seccion ? `seccion=${encodeURIComponent(seccion)}` : ''}`;
      }

      fetch(url)
          .then(response => response.json())
          .then(data => buildForm(data))
          .catch(error => console.error('Error al cargar las preguntas:', error));
  }

    // Cargar las preguntas cuando la página se cargue
    document.addEventListener('DOMContentLoaded', cargarPrimerasPreguntas);






    // Definir la función loadQuestions correctamente
  async function loadCheckbox() {
    let url = '/preguntas';
  
    // Agregar parámetros a la URL si existen
    let capitulo = "C";
    let seccion = 2;
    if (capitulo || seccion) {
      url += `?${capitulo ? `capitulo=${encodeURIComponent(capitulo)}` : ''}${capitulo && seccion ? '&' : ''}${seccion ? `seccion=${encodeURIComponent(seccion)}` : ''}`;
    }
  
      // Retornar el fetch para manejarlo como una Promise
    try {
      const response = await fetch(url);
      const data = await response.json();
      return data; // Devolver los datos parseados
    } catch (error) {
      console.error('Error al cargar las preguntas:', error);
      throw error;
    }
  }
  </script>

  <script>
    // Función para cargar los registros desde la API y generar los checkboxes
    async function cargarRegistros() {
      try {
        const response = await loadCheckbox();
        const registros = response;
        console.table(registros)
        const matriz = document.getElementById('checkbox-matriz');
        
        registros.forEach((registro, index) => {
          const checkboxDiv = document.createElement('div');
          checkboxDiv.className = 'checkbox-item';
          checkboxDiv.innerHTML = `
            <label>
              <input type="checkbox" name="registro" value="${index}">
              ${registro.Descrip} <!-- Ajusta según tu base de datos -->
            </label>
          `;
          matriz.appendChild(checkboxDiv);
        });
      } catch (error) {
        console.error('Error al cargar los registros:', error);
      }
    }

    cargarPrimerasPreguntas();
    cargarRegistros(); // Cargar los registros al cargar la página


    // Manejar el envío del formulario
    document.getElementById('checklist-form').addEventListener('submit', function(event) {
      event.preventDefault(); // Evita el envío estándar

      const checkboxes = document.querySelectorAll('input[name="registro"]');
      const seleccionados = Array.from(checkboxes).map(checkbox => checkbox.checked ? 1 : 0);

      console.log (seleccionados)

      // Enviar los datos seleccionados al backend
      // fetch('/procesar', {
      //   method: 'POST',
      //   headers: {
      //     'Content-Type': 'application/json'
      //   },
      //   body: JSON.stringify({ seleccionados })
      // })
      // .then(response => response.text())
      // .then(data => {
      //   alert(data); // Mostrar respuesta del servidor
      // })
      // .catch(error => {
      //   console.error('Error al enviar los datos:', error);
      // });
    });



</script>

<script>
  const apellidouser = localStorage.getItem("apellido");
  const nombreUser = localStorage.getItem("nombre");
  const apenom = nombreUser + ' ' + apellidouser;
  const empresa = localStorage.getItem("empresa");
  document.getElementById("nombreEmpresa").textContent = empresa;
  document.getElementById("nombreUsuario").textContent = apenom;

  document.getElementById('surveyForm').addEventListener('submit', function (event) {
    event.preventDefault();
  });
  const botonSalida = document.getElementById('boton-salir');
  const ventanaSale = document.getElementById('ventanaSalida');
  const botonYes = document.getElementById('confirm-yes');
  const botonNou = document.getElementById('confirm-no');

  botonSalida.addEventListener('click', () => { // Agrega un evento al botón para mostrar la ventana
    let isExiting = true;
    ventanaSale.style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
  });

  botonNou.addEventListener('click', () => {  // Agrega un evento para el botón NO
    isExiting = true;
    console.log('dijo que NO')
    ventanaSale.style.display = 'none';
    document.getElementById('overlay').style.display = 'none'; // Continúa con la operación original de la página
  });

  botonYes.addEventListener('click', () => {  // Agrega un evento para el botón SI
    console.log('dijo que SI')
    isExiting = true;
    window.location.href = '../../index.html';
  });
</script>

<script>
  function resumenGeneral() {
  
      window.location.href =
          JSON.parse(localStorage.getItem("idioma")) == 1
            ? "resumenGeneral3.html"
            : "resumenGeneral3-en.html";
  
  }
  
  function limpiarSelecciones() {
          location.reload(); // Recarga la página para restablecer el formulario
      }
  </script>

    </html>