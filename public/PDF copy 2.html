<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación de riesgos</title>
    <script src="https://cdn.jsdelivr.net/npm/gaugeJS/dist/gauge.min.js"></script>
    <link href="../estilos/estiloEncuestas.css" rel="stylesheet">
    <!-- <link href="css/st-gobCorpo.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Abel&family=Barlow+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Courgette&family=Gupter:wght@400;500;700&family=PT+Sans+Narrow:wght@400;700&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Serif:ital,opsz,wght@0,8..144,100..900;1,8..144,100..900&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
    <div class="survey-container">
        <section class="main">
            <section class="gobCorpo">
                <div class="header-container">
                    <div class="header-center">
                        <div id="nombreEmpresa" class="company-name"></div>
                        <div id="nombreUsuario" class="user-name"></div>
                    </div>
                    <div class="nav-iconsxx">
                        <h4> A - Manejo de los Riesgos de Gobierno Corporativo</h4>
                    </div>
                    <div class="nav-iconsxx">
                        <h5> Autoevaluación</h5>
                    </div>
                </div>
                <hr>

                <form id="formulario">

                    <div class="centrado-flex">
                        <button type="submit" id="boton-enviar">Generar</button>
                        <button type="button" id="boton-generar-pdf">Generar PDF</button>
                    </div>
                </form>
            </section>
        </section>
    </div>
</body>


<!-- https://claude.ai/chat/da1b05d0-f15d-487d-bd62-f4f05b81c356
https://claude.ai/login?returnTo=%2F%3F
El tamaño de una hoja A4 es de 210 x 297 milímetros, es decir, 21 centímetros de ancho por 29,7 centímetros de largo.  -->

<script>

    const textoTipificacion = localStorage.getItem("textoTipificacion");
    const tipificacion = localStorage.getItem("tipificacion");

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("boton-generar-pdf").addEventListener("click", generarPDF);
    });

    function generarPDF() {
        // Crear un elemento temporal para construir el contenido HTML
        // Generamos el PDF después de dibujar el hexágono
        const opciones = {
            margin: 0,
            filename: 'documento.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };


        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
        // ♦ Añadir la quinta página (contenido) con un borde
        // ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

        function dibujarHexagonoPDF() {

            // Añadir el container para el canvas
            const canvasContainer = document.createElement('div');
            canvasContainer.style.width = '100%';
            canvasContainer.style.display = 'flex';
            canvasContainer.style.justifyContent = 'center';
            canvasContainer.style.marginTop = '10mm';

            // Crear el canvas para el hexágono
            const hexagonoCanvas = document.createElement('canvas');
            hexagonoCanvas.id = 'hexagonoPDF';
            hexagonoCanvas.width = 500;
            hexagonoCanvas.height = 500;
            canvasContainer.appendChild(hexagonoCanvas);

            quintaPagina.appendChild(canvasContainer);

            // Agregar la página completa al contenido
            if (contenido) {
                contenido.appendChild(quintaPagina);
            } else {
                console.error("El contenedor 'contenido' no existe.");
            }

            // Ahora dibujamos el hexágono en el canvas
            const canvasPDF = document.getElementById('hexagonoPDF');

            if (!canvasPDF) {
                console.error("No se encontró el canvas con ID 'hexagonoPDF'.");
                return null;
            }

            const ctx = canvasPDF.getContext('2d');
            if (!ctx) {
                console.error("No se pudo obtener el contexto 2D del canvas.");
                return null;
            }

            const var1 = 59.91, var2 = 89.50, var3 = 59.09, var4 = 72.64, var5 = 63.00, var6 = 41.36;
            let variablesHexagono = [var1, var2, var3, var4, var5, var6];

            const rotulosHexagono = ['Gobierno Corporativo', 'Apetito Riesgo', 'Riesgos Mercado', 'Riesgos Procesos', 'Situación Financiera', 'Generación Resultados'];

            // Dibujamos el hexágono en el canvas del PDF

            const centerX = canvasPDF.width / 2;
            const centerY = canvasPDF.height / 2;
            const radioMax = 170;
            const radio90 = radioMax * 0.9;
            const radio70 = radioMax * 0.7;
            const radio50 = radioMax * 0.5;

            ctx.clearRect(0, 0, canvasPDF.width, canvasPDF.height);

            // Aquí insertaría todo el código de dibujarHexagono
            // Dibuja el fondo celeste del hexágono principal
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const x = centerX + radioMax * Math.cos(angulo);
                const y = centerY + radioMax * Math.sin(angulo);

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fillStyle = 'rgba(173, 216, 230, 0.7)';
            ctx.fill();
            ctx.strokeStyle = 'black';
            ctx.stroke();

            // Dibuja el hexágono verde (90%)
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const x = centerX + radio90 * Math.cos(angulo);
                const y = centerY + radio90 * Math.sin(angulo);

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fillStyle = 'rgba(0, 255, 0, 0.7)';
            ctx.fill();
            ctx.strokeStyle = 'green';
            ctx.stroke();

            // Dibuja el hexágono amarillo (70%)
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const x = centerX + radio70 * Math.cos(angulo);
                const y = centerY + radio70 * Math.sin(angulo);

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fillStyle = 'rgba(255, 255, 0, 0.7)';
            ctx.fill();
            ctx.strokeStyle = 'yellow';
            ctx.stroke();

            // Dibuja el hexágono rojo (50%)
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const x = centerX + radio50 * Math.cos(angulo);
                const y = centerY + radio50 * Math.sin(angulo);

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fillStyle = 'rgba(255, 0, 0, 0.9)';
            ctx.fill();
            ctx.strokeStyle = 'red';
            ctx.stroke();

            // Dibuja las líneas desde el centro hacia los vértices
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const x = centerX + radioMax * Math.cos(angulo);
                const y = centerY + radioMax * Math.sin(angulo);

                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
            }
            ctx.strokeStyle = 'gray';
            ctx.stroke();

            // Dibuja el área basada en las variables
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const porcentaje = variablesHexagono[i] / 100;
                const radio = radioMax * porcentaje;
                const x = centerX + radio * Math.cos(angulo);
                const y = centerY + radio * Math.sin(angulo);

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fillStyle = 'rgba(0, 150, 255, 0.7)';
            ctx.fill();
            ctx.strokeStyle = 'blue';
            ctx.stroke();

            // Agregar el valor de cada variable
            ctx.font = '17px "Arial", strong';
            ctx.fillStyle = 'black';
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const porcentaje = variablesHexagono[i] / 100;
                const radioTexto = radioMax * porcentaje * 0.9;
                const xTexto = centerX + radioTexto * Math.cos(angulo);
                const yTexto = centerY + radioTexto * Math.sin(angulo);
                ctx.fillText(`${variablesHexagono[i]}%`, xTexto - 15, yTexto + 5);
            }

            // Agregar los rótulos
            ctx.font = '15px "Arial", strong';
            ctx.fillStyle = 'black';
            for (let i = 0; i < 6; i++) {
                const angulo = (i * Math.PI) / 3;
                const xRotulo = centerX + (radioMax + 20) * Math.cos(angulo);
                const yRotulo = centerY + (radioMax + 20) * Math.sin(angulo);
                const palabras = rotulosHexagono[i].split(' ');

                if (i === 3) {
                    ctx.fillText(palabras[0], xRotulo - 35, yRotulo - 5);
                    ctx.fillText(palabras[1], xRotulo - 35, yRotulo + 14);
                } else {
                    ctx.fillText(palabras[0], xRotulo - 18, yRotulo - 5);
                    ctx.fillText(palabras[1], xRotulo - 18, yRotulo + 14);
                }
            }
            console.log("Hexágono dibujado correctamente.");

            return canvasPDF;
        }

        const contenido = document.createElement('div');
        const quintaPagina = crearPaginaConMarco();

        parrafo = document.createElement('p');
        parrafo.style.fontFamily = 'Helvetica, Arial, sans-serif';
        parrafo.style.fontSize = '14pt';
        parrafo.style.lineHeight = '1.5';
        parrafo.innerHTML = "<strong><span class='company-name' style='font-size: 16px'>QUINTA PAGINA</span></strong> modelo grafico";

        quintaPagina.appendChild(parrafo);

        // Create the canvas before generating PDF
        const hexagonoCanvas = document.createElement('canvas');
        hexagonoCanvas.id = 'hexagonoPDF';
        hexagonoCanvas.width = 500;
        hexagonoCanvas.height = 500;
        hexagonoCanvas.style.display = 'none'; // Hide it
        document.body.appendChild(hexagonoCanvas);

        // Draw hexagon
        const drawnCanvas = dibujarHexagonoPDF();

        if (drawnCanvas) {
            // Proceed with PDF generation
            html2pdf().from(contenido).set(opciones).save().then(() => {
                // Clean up
                document.body.removeChild(hexagonoCanvas);
                document.body.removeChild(contenido);
            });
        } else {
            console.error("Failed to draw hexagon");
        }

    }


    ///
    // Alternativa: Capturar el canvas existente
    // const canvasExistente = document.getElementById('hexagonoCanvas');
    // if (canvasExistente) {
    //     const imagenDataURL = canvasExistente.toDataURL('image/png');

    //     const imagenHexagono = document.createElement('img');
    //     imagenHexagono.src = imagenDataURL;
    //     imagenHexagono.style.maxWidth = '100%';
    //     imagenHexagono.style.height = 'auto';

    //     cuartaPagina.appendChild(imagenHexagono);
    // }
    ///
    function crearPaginaConMarco() {
        const pagina = document.createElement('div');
        pagina.style.padding = '10mm';
        pagina.style.margin = '10mm';
        pagina.style.border = '2px solid #000';
        pagina.style.boxShadow = '0 0 10mm rgba(0,0,0,0.1)'; // Sombra suave
        pagina.style.minHeight = '240mm';
        pagina.style.borderRadius = '5mm';
        pagina.style.position = 'relative'; // Para posicionar elementos internos
        pagina.style.pageBreakAfter = 'always'; // Salto de página después
        return pagina;
    }

</script>

</html>